# [Контест RMQ/RSQ](https://drive.google.com/file/d/1ER4b-Z-wEb57fyw974pPg6bjvij3R8l4/view?usp=sharing)

## Задача 1 (Копатыч и искусство легких касаний)

Если честно, то в жизни мне повезло лишь однажды: когда я встретил вас — моих друзей.

За окном rain, на душе pain, а смешарики устраивают смотр ледяных скульптур! Правила конкурса следующие: статуи выставляются в ряд, каждый смешарик голосует за понравившиеся ему бюсты. После этого Копатыч, как единственный независимый судья (независимый, потому что проспал весь творческий процесс) пытается определить лучшую ледяную композицию.

По мнению медведя композицией может быть любой подотрезок из ряда скульптур (Копатыч сельский житель и плохо разбирается в искусстве). Также Копатыч верит в то, что лучшая композиция — композиция, у скульптур в которой суммарное количество голосов максимально.

Помогите Копатычу написать программу, которая по его запросу будет говорить суммарное количество голосов за ледяную композицию.

**Формат ввода** \
В первой строке вводится одно натуральное число $N (1≤N≤10^5)$ — количество скульптур, выставленных в ряд. Во второй строке вводятся $N$ чисел от $1$ до $10^5$ — количество голосов у скульптур в ряду. В третьей строке вводится одно натуральное число 
$K (1≤K≤3⋅10^4)$ — количество запросов Копатыча. В следующих $K$ строках вводится по два числа — номера левого и правого концов композиции (считается, что скульптуры нумеруются с единицы).

**Формат вывода** \
Для каждого запроса выведите сумму чисел соответствующей композиции скульптур. Числа выводите в одну строку через пробел.

**Пример** 
| **Ввод**  | **Вывод** |
|-----------|-----------|
| 5         | 8 16      |
| 4 4 8 7 8 |           |
| 2         |           |
| 1 2       |           |
| 1 3       |           |


**Примечания** \
Сложность решения должна быть $O(N+K)$.

## Задача 2 (Укуси меня пчела)

Ёлки-иголки, да что же это такое тут происходит?

После ударного дачного сезона Копатыч расставил свои ульи в ряд, чтобы определить лучшую пчелиную семью (подотрезок ряда).

Качество пчелиной семьи Копатыч определяет по наибольшему количеству собранного меда в одном улье. Периодически Копатыч собирает дополнительный мед из того или иного улья.

Необходимо помочь Копатычу определить качество каждой пчелиной семьи и разобраться в его отношениях со сбором меда.

**Формат ввода** \
В первой строке вводится одно натуральное число $N (1≤N≤100000)$ — количество ульев в ряду.

Во второй строке вводятся 
$N$ чисел от $0$ до $100000$ — количество собранного меда с каждого улья в начальный момент.В третьей строке вводится одно натуральное число $M (1≤M≤30000)$ — количество запросов Копатыча. Каждая из следующих $M$ строк представляет собой описание запроса. Сначала вводится одна буква, кодирующая вид запроса ($m$ — найти наибольшее число собранного меда в семье, $a$ — увеличить число собранного меда у пчелиной семьи).

Следом за $m$ вводятся два числа — левая и правая граница ряда.

Следом за $a$ вводятся три числа — левый и правый концы ряда и число $add$, на которое нужно увеличить количество собранного меда у каждого улья данной пчелиной семьи 
$(0≤add≤100000)$.

**Формат вывода** \
Выведите в одну строку через пробел ответы на каждый запрос $m$.

**Пример** 
| **Ввод**  | **Вывод** |
|-----------|-----------|
| 5         | 4 104 104 |
| 2 4 3 1 5 |           |
| 5         |           |
| m 1 3     |           |
| a 2 4 100 |           |
| m 1 3     |           |
| a 5 5 10  |           |
| m 1 5     |           |

## Задача 3 (Как собрать друзей по-быстрому)

Честно говоря, я не то чтобы заболела, просто появилась возможность покататься на кроватке, ну и грех было не воспользоваться.

Собирать гостей — большая наука. Одного радушия порой маловато, требуется выдумка и недюжинная смелость. Поэтому Нюша берётся за дело: притворившись больной, она просит друзей навестить её. Реализуйте структуру данных, которая поддерживает множество $S$ целых чисел порядковых номеров смешариков (это число показывает, каким смешарик пришел на фан-встречу: пятым, десятым, пятидесятым…), с которым разрешается производить следующие операции:

- $add(i)$ — добавить в множество гостей $S$ число $i$  — настроение пришедшего к Нюше смешарика (если оно там уже есть, то множество не меняется);
- $sum(l, r)$ — вывести сумму всех элементов $x$ из $S$, которые удовлетворяют неравенству $l ≤ x ≤ r$. Нюша хочет знать как зависит настроение смешарика от времени, от его порядковой позиции в списке гостей.

**Формат ввода** \
Исходно множество $S$ пусто. Первая строка входного файла содержит n — количество операций $(1 ≤ n ≤ 3 ⋅ 10^5)$. Следующие n строк содержат операции. Каждая операция имеет вид либо $«+ i»$, либо $«? l r»$. Операция $«+ i»$ задает запрос $add(i)$. Операция $«? l r»$ задает запрос $sum(l, r)$.

Во всех запросах и операциях добавления параметры лежат в интервале от $0$ до $10^9$.

**Формат вывода** \
Для каждого запроса выведите одно число — ответ на запрос.

**Пример**

| **Ввод** | **Вывод** |
|----------|-----------|
| 6        | 3         |
| + 1      | 7         |
| + 3      |           |
| + 3      |           |
| ? 2 4    |           |
| + 4      |           |
| ? 2 4    |           |

## Задача 4 (Ёжик и Кордебалет)

Крош: Чем больше трудностей, тем лучше. В трудностях познается характер.

Ёжик: А может, некоторым лучше и не знать про свой характер. Вдруг ты такое узнаешь, что потом жить… не-за-хо-чет-ся!

Ёжика вновь назначили ответственным за репетицию кордебалета. И вот смешарики под угрозой записи в книжечку вновь выстроились в шеренгу и рассчитались по порядку $(с 1 по n)$.

В поисках оптимального построения Ёжик то и дело отдает команды перестроения шеренги. Звучат они так: Смешарики с $l_i$ по $r_i$ — в начало!. После этой команды смешарики стоящие в позициях с $l_i$ по $r_i$ включительно, немедленно перемещаются в начало шеренги, сохраняя относительный порядок.

Например, если в некоторый момент смешарики стоят в порядке $2,3,6,1,5,4$ (каждому смешарику присвоен свой номер), то после команды: Смешарики с $2$ по $4$ — в начало! порядок будет $3,6,1,2,5,4$.

Помогите Ёжику разобраться, в каком порядке должны стоять смешарики после выполнения всех его команд, иначе он вас запишет в книжечку.

**Формат ввода** \
В первой строке два целых числа $n and m (2≤n≤100000,1≤m≤100000)$ — количество смешариков и количество команд от Ёжика. Следующие m строк содержат по два целых числа $l_i$ и $r_i$ $(1≤l_i≤r_i≤n)$.

**Формат вывода** \
Выведите $n$ целых чисел — порядок после выполнения всех команд.

**Пример**

| **Ввод** | **Вывод**   |
|----------|-------------|
| 6 3      | 1 4 5 2 3 6 |
| 2 4      |             |
| 3 5      |             |
| 2 2      |             |

## Задача 5 (Смешарики переходят на второй курс)

Скоро начало учебного года, а значит, многие смешарики вынуждены переселяться из привычного коридорного общежития в апартаменты премиум-класса. К сожалению, недобросовестные смешарики постоянно затягивают свой переезд, поэтому новичкам Шарарама приходится въезжать в комнаты, заполненные вещами дедов. В некоторых общежитиях практикуется выставление вещей предыдущих жильцов за дверь (иногда даже самими предыдущими жильцами), позднее кто-то (доподлинно неизвестно, кто) эти вещи забирает. Однако выставленные в проход вещи противоречат технике пожарной безопасности, а проверка регулярно посещает общежития.

Итак, сама задача: в общежитии имеется длинный основной коридор, который никак не должен быть захламлен по ТБ, но на мелкие нарушения проверка готова закрыть глаза. В этот коридор постоянно кто-то выставляет вещи, а кто-то постоянно их оттуда забирает. Когда приходит проверка, она считает, сколько предметов выставлено в коридор между двумя комнатами с заданными номерами (эти номера выбираются комиссией, проводящей проверку). Смоделируйте происходящее на языке $C++$.

**Формат ввода** \
В первой строке входного файла содержатся два числа: $N$ -- максимальный номер комнаты $(1≤N≤10000)$ и $M$ -- количество производимых в коридоре действий $(1≤M≤50000)$. Каждое действие имеет вид "1 L R S", что означает, что на участок коридора от $L$-ой комнаты до $R$-ую комнаты между всеми соседними комнатами выставили $S$ предметов ($S$ может быть и отрицательным, тогда это означает, что предметы из коридора забрали), или "2 L R", что значит, что проверка интересуется, сколько предметов выставлено на участке коридора от $L$-ой комнаты до $R$-й. Комнаты нумеруются от $0$ до $N$. Гарантируется, что для запросов вида "1 L R S" при $S<0$ на каждом участке между соседними комнатами от $L$ до $R$ число предметов составляет не менее $S$.

**Формат ввывода** \
На каждую команду 2 (запрос) вы должны выводить число $K$ --- суммарное число предметов, находящихся между $L$-й и $R$-й комнатами. Каждое число должно выводиться на новой строке. Известно, что в процессе работы суммарное количество предметов на любом интервале не превышает $2^31$.

**Пример**

| **Ввод** | **Вывод** |
|----------|-----------|
| 10 5     | 37        |
| 1 0 9 10 | 67        |
| 1 1 5 -3 |           |
| 2 4 8    |           |
| 1 0 6 25 |           |
| 2 0 2    |           |

## Задача 6 (RMQ + insert)

— Земля круглая! Это доказано сотни лет назад!

— Ты сам-то в это веришь? Почему же тогда с обратной стороны ничего не падает?

— На земле всё удерживает гравитация.

— Слишком сложно, чтобы быть правдой. Вот с черепахой — тут всё ясно.

— Вы не можете отрицать очевидное! Джордано Бруно отдал жизнь ради этой истины!

— Ну это уж совсем не доказательство…

Вы уже решали задачу RMQ, даже если есть обновления на отрезке. В этот раз границы решения этой задачи будут расширены. А именно, надо разработать структуру данных в виде массива, который умеет обрабатывать следующие запросы:

- «? l r» — найти минимум на отрезке [l, r] в 1-индексации;
- «+ i x» — добавить элемент x после i-го (в 1-индексации) элемента. Если i = 0, то вставка идет в начало списка.

Изначально структура пустая.

**Формат ввода** \
Первая строка входного файла содержит единственное целое число $n$ — число операций над массивом $(1 ≤ n ≤ 2 ⋅ 105)$. Следующие n строк описывают сами операции. Все операции добавления являются корректными. Все числа, хранящиеся в массиве, по модулю не превосходят $109$.

**Формат вывода** \
Для каждой операции в отдельной строке выведите её результат.

**Пример**

| **Ввод** | **Вывод** |
|----------|-----------|
| 8        | 4         |
| + 0 5    | 3         |
| + 1 3    | 1         |
| + 1 4    |           |
| ? 1 2    |           |
| + 0 2    |           |
| ? 2 4    |           |
| + 4 1    |           |
| ? 3 5    |           |